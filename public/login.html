<!doctype html>
<html>
<head>
<script type="text/javascript" src="https://static.nid.naver.com/js/naveridlogin_js_sdk_2.0.0.js" charset="utf-8"></script>
<script src="https://apis.google.com/js/platform.js" async defer></script>
<meta name="google-signin-client_id" content="975124663159-q37pcek6dhp9vlido8qkk5euh57sqeu9.apps.googleusercontent.com">
<script>
function onSignIn(googleUser) {
  var profile = googleUser.getBasicProfile();
  var user = firebase.auth().currentUser;
var name, email, photoUrl, uid, emailVerified;

if (user != null) {
  name = user.displayName;
  email = user.email;
  photoUrl = user.photoURL;
  emailVerified = user.emailVerified;
  uid = user.uid;  // The user's ID, unique to the Firebase project. Do NOT use
                   // this value to authenticate with your backend server, if
                   // you have one. Use User.getToken() instead.
                   console.log(uid);
                   var infoRef = firebase.database().ref('userInfo/'+uid+'/');
                   infoRef.child("info").set({"id": uid, "name":profile.getName(), "email":profile.getEmail()});
}else{
  console.log("먼가 문제가잇ㅇ므");
}
  console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
  console.log('Name: ' + profile.getName());
  console.log('Image URL: ' + profile.getImageUrl());
  console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
}
</script>
</head>
<body>

<!-- // 네이버아이디로로그인 초기화 Script -->
<div id="googlelogin" class="g-signin2" data-onsuccess="onSignIn" data-width="185" data-height="40"></div>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<button id="logoutBtn">로그아웃</button>
<script src="/__/firebase/8.1.1/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="/__/firebase/8.1.1/firebase-analytics.js"></script>

<!-- Initialize Firebase -->
<script src="/__/firebase/init.js?useEmulator=true"></script>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
 <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-auth.js"></script>
 <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-database.js"></script>
<script src="googlelogin.js"></script>

<script>
var logoutBtn =  document.getElementById("logoutBtn");
var googlelogin = document.getElementById("googlelogin");
   googlelogin.onclick = function(){
     firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(()=>{
        var provider = new firebase.auth.GoogleAuthProvider();
         firebase.auth().onAuthStateChanged(function(user){
         if(user){
         }else{
           firebase.auth().signInWithPopup(provider).then(function(result) {
               firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);
               opener.parent.location.reload();
               window.close();
            }).catch(function(error) {

                });
               }
         });
     })

   }


   logoutBtn.onclick = function(){
     firebase.auth().signOut().then(function() {
       alert("로그아웃되었습니다");
  // Sign-out successful.
  opener.parent.location.reload();
  window.close();
}).catch(function(error) {
  // An error happened.
});
   }

   firebase.auth().onAuthStateChanged(function(user){
   if(user){
     console.log("로그인상태");
     googlelogin.style.display="none";
     logoutBtn.style.display="block";
     localStorage.setItem("logined","logined");
     localStorage.setItem("logouted",null);
   }else{
     console.log("로그아웃상태");
     googlelogin.style.display="block";
     logoutBtn.style.display="none";
     localStorage.setItem("logined",null);
     localStorage.setItem("logouted","logouted");
         }
   });

</script>

</body>
</html>
