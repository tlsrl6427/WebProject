<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="html5/assets/css/main.css" />
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-storage.js"></script>
    <script src="googlelogin.js?useEmulator=true"></script>

    <script>
      function initApp() {
        firebase.auth().onAuthStateChanged(function(user) {
      			if (user) {
      				console.log("로그인 상태");
      				name = user.displayName;
      				email = user.email;
      				photoUrl = user.photoURL;
      				emailVerified = user.emailVerified;
      				uid = user.uid;
              console.log(name);
              document.getElementById("username").innerHTML=name;
            } else {
                console.log("로그아웃 상태");

          }
            });

  }

      window.onload = function() {
      initApp();
    }

    function list_change(){
      document.getElementById("selected_sports").style.display="none";
      document.getElementById("selected_music").style.display="none";
      document.getElementById("selected_living").style.display="none";
      document.getElementById("selected_computer").style.display="none";
      document.getElementById("selected_game").style.display="none";

    var s = document.getElementById("selected_category");
    var selected_option = s.options[s.selectedIndex].value;

    switch(selected_option){
      case 'A': document.getElementById("selected_sports").style.display="block";
          break;
      case 'B': document.getElementById("selected_music").style.display='block';
          break;
      case 'C': document.getElementById("selected_living").style.display='block';
          break;
      case 'D': document.getElementById("selected_computer").style.display='block';
          break;
      case 'E': document.getElementById("selected_game").style.display='block';
          break;
    }
    }

    function db(){
      var user = firebase.auth().currentUser;
      if (user != null) {
        name = user.displayName;
        email = user.email;
        photoUrl = user.photoURL;
        emailVerified = user.emailVerified;
        uid = user.uid;
      }else{
        console.log("먼가 문제가잇ㅇ므");
      }

      var channelRef_user = firebase.database().ref('userInfo/'+uid);
      var channelRef_list = firebase.database().ref('spec_List/');

      //요소
      var d = new Date();
      var date = d.getFullYear() + "_" + d.getMonth() + "_" + d.getDate() + "_" + d.getHours() + "_" + d.getMinutes();
      var time=date+ "_" + d.getSeconds();
      var title = document.getElementById("title").value;
      var contents = document.getElementById("contents").value;
      var username = name;

      var s = document.getElementById("selected_category");
      var selected_option = s.options[s.selectedIndex].value;
      var selected_opt;

      switch(selected_option){
        case 'A':   var s = document.getElementById("selected_sports");
                    var selected_opt = s.options[s.selectedIndex].value;
            break;
        case 'B': var s = document.getElementById("selected_music");
                    var selected_opt = s.options[s.selectedIndex].value;
            break;
        case 'C': var s = document.getElementById("selected_living");
                    var selected_opt = s.options[s.selectedIndex].value;
            break;
        case 'D': var s = document.getElementById("selected_computer");
                    var selected_opt = s.options[s.selectedIndex].value;
            break;
        case 'E': var s = document.getElementById("selected_game");
                    var selected_opt = s.options[s.selectedIndex].value;
            break;
      }
      console.log("선택된 옵션: "+selected_opt);

      channelRef_user.child('spec_list').push({"title": title, "time": time, "contents": contents, "username": username, "category": selected_opt});
     channelRef_list.push({
       "title":title,
       "time": time,
       "contents": contents,
       "userid": uid,
       "username": username,
       "category": selected_opt
     },(error) => {
  if (error) {
    // The write failed...
  } else {


    // 레벨기능
                 var exp;
                 var lv;
                 var levelRef = firebase.database().ref('userInfo/'+uid+"/level_info/");
                 levelRef.once("value",function(snapshot){
                   exp = snapshot.val().exp;
                   lv = snapshot.val().level;


                 exp +=30;
                 console.log("게시판 업로드 성공");

                 if(Math.pow(2,lv-1)*50 <= exp ){
                   if(Math.pow(2,lv)*50 <= exp){
                     lv +=1;

                     console.log("레벨업 축하드립니다");
                   }
                 }

                 levelRef.update({
                   exp: exp,
                   level: lv
                 });

                 });





    alert("작성이 완료되었습니다");
   location.href='specboard_list.html';
  }
});

    }
      </script>
      <style>
      body{

              font-family:"맑은 고딕";
      }
          ul, li{
              list-style:none;
              padding:0;
              margin:0;
      }

          #mainWrapper{
              width: 1000px;
              margin: 0 auto; /*가운데 정렬*/
          }

      #mainWrapper > ul > li:first-child {
              text-align: center;
              font-size:14pt;
              height:40px;
              vertical-align:baseline;
              line-height:30px;
      }
      </style>
  </head>

  <body class="is-preload">
    <div id="wrapper">
      <div id="main">
        <div class="inner">


          <div>
            <label><h3>카테고리</h3></label>
            <li id='category'>
                <div >
                    <select id='selected_category' onchange="list_change()">
                        <option value="A">스포츠</option>
                        <option value='B'>음악</option>
                        <option value='C'>생활</option>
                        <option value='D'>컴퓨터</option>
                        <option value='E'>게임</option>
                    </select>
                </div>
            </li>


                <div >
                    <select id='selected_sports'>
                        <option value='basketball'>농구</option>
                        <option value='baseball'>야구</option>
                        <option value='football'>축구</option>
                        <option value='swimming'>수영</option>
                    </select>
                </div>


                <div >
                    <select id='selected_music' style="display:none">
                        <option value='piano'>피아노</option>
                        <option value='guitar'>기타</option>
                        <option value='flute'>플룻</option>
                        <option value='violin'>바이올린</option>
                    </select>
                </div>

                <div >
                    <select id='selected_living' style="display:none">
                        <option value='cleaning'>청소</option>
                        <option value='saving'>저축</option>
                        <option value='cooking'>요리</option>
                        <option value='education'>교육</option>
                    </select>
                </div>

                <div >
                    <select id='selected_computer' style="display:none">
                        <option value='web'>웹프로그래밍</option>
                        <option value='db'>데이터베이스</option>
                        <option value='data_com'>데이터통신</option>
                        <option value='language'>언어(자바/C++)</option>
                    </select>
                </div>

                <div >
                    <select id='selected_game' style="display:none">
                        <option value='lol'>롤</option>
                        <option value='fifa'>피파</option>
                        <option value='maplestory'>메이플</option>
                        <option value='cartrider'>카트라이더</option>
                    </select>
                </div>
            </div>
            <div style="margin-top:55px;">
              <label><h3>제목</h3></label>
              <input type="text" id='title' placeholder = "제목을 입력하세요"></input>
            </div>
            <div style="margin-top:55px">
              <label><h3>내용</h3></label>
              <textarea id='contents' cols="60" rows="10" placeholder = "내용을 입력하세요"></textarea>
            </div>
            <br>
            <br>
            <br>
            <br>
            <div>
              문서 찾아보기: <input type="file" id="input_video" multiple/><br>
            </div>

            <div style="margin-top:55px">
              <button type="button" onclick="db();">저장</button>

              <button type="button" onclick="location.href='specboard_list.html'" >취소</button>
            </div>

            <!--
           <form>
               <table>
                   <tbody>
                      <tr>
                        <th>카테고리 :
                        <li>
                            <div style=" margin: 5px 5px 5px 5px">
                                <select id='writeCategoryOption' >
                                    <option value='A'>농구</option>
                                    <option value='T'>축구</option>
                                    <option value='C'>배구</option>

                                </select>

                            </div>
                        </li>
                        </th>
                      </tr>
                       <tr>
                           <th>제목 : </th>
                           <td><input id="title" placeholder = "제목을 입력하세요"></td>
                       </tr>
                       <tr>
                           <th>작성자 : </th>
                           <td id="username"></td>
                       </tr>
                       <tr>
                           <th>내용 : </th>
                           <td><textarea id='contents' cols="60" rows="10" placeholder = "내용을 입력하세요"></textarea></td>
                       </tr>
                   </tbody>
               </table>
               <button type="button" onclick="db();">저장</button>

               <button type="button" onclick="location.href='studyboard_list.html'" >취소</button>

           </form>-->
       </div> </div></div>

  </body>
</html>
