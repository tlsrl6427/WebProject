<!DOCTYPE HTML>

<html>
	<head>
		<title>E-tube</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../../html5/assets/css/main.css" />
		<script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-database.js"></script>
		<script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-storage.js"></script>
    <script src="../../googlelogin.js?useEmulator=true"></script>
		<script src="../../openPopup.js"></script>
<script>
function createDiv(testid, name){
		var newDIVout = document.createElement("div");
		newDIVout.setAttribute("width","220px");
		newDIVout.setAttribute("id", testid+"_out");
		newDIVout.setAttribute("height","220px");
		newDIVout.style.float="left";
		newDIVout.style.margin="20px";
		document.getElementById("sec").appendChild(newDIVout);

		var newDIVimg = document.createElement("div");
		newDIVimg.setAttribute("id", testid+"_in");
		newDIVimg.setAttribute("class", "image-container");
		newDIVimg.setAttribute("height","160px");
		newDIVimg.setAttribute("width","200px");
		newDIVimg.style.float="left";
		newDIVimg.style.overflow="hidden";
		newDIVimg.style.display="flex";
		newDIVimg.style.alignItems="center";
		newDIVimg.style.justifyContent="center";
		newDIVimg.style.margin="10px";
		document.getElementById(testid+"_out").appendChild(newDIVimg);

		var newA = document.createElement("a");
		newA.setAttribute("href", "../../channel_private.html?"+name);
		newA.setAttribute("id", testid+"_a");
		newA.setAttribute("class", "test");
		document.getElementById(testid+"_in").appendChild(newA);

		var newImg = document.createElement("img");
		newImg.setAttribute("id", testid+"_img");
		newImg.setAttribute("onload", "resize(this)");
		newImg.style.display="block";
		document.getElementById(testid+"_a").appendChild(newImg);

		var newDIVname = document.createElement("div");
		newDIVname.style.marginLeft="10px";
		newDIVname.style.height="220px";
		newDIVname.innerHTML = "<strong>" + name + "</strong>"+"<br>"+"구독자수, 동영상수";
		document.getElementById(testid+"_out").appendChild(newDIVname);
}

function resize(img){

   var width = img.width;
   var height = img.height;

   var maxWidth = 160;
   var maxHeight = 200;

   if(width > maxWidth || height > maxHeight){

      if(width > height){
         resizeWidth = maxWidth;
         resizeHeight = (height * resizeWidth) / width;

      }else{
         resizeHeight = maxHeight;
         resizeWidth = (width * resizeHeight) / height;
      }

   }else{
      resizeWidth = width;
      resizeHeight = height;
   }

   img.width = resizeWidth;
   img.height = resizeHeight;
}

function initApp(){
	// Listening for auth state changes.
	firebase.auth().onAuthStateChanged(function(user) {
			if (user) {
				var id = "test";
				var idnum =1;
				console.log("로그인 상태");
				name = user.displayName;
				email = user.email;
				photoUrl = user.photoURL;
				emailVerified = user.emailVerified;
				uid = user.uid;
				temp = location.href.split("/");
				temp1 = temp[5].split(".");
				console.log(temp1[0]);

				var dataRef = firebase.database().ref('/channel_List');
				dataRef.once('value', (snapshot)=>{
					snapshot.forEach((childSnapshot) => {
					var childKey = childSnapshot.key;
     			var childData = childSnapshot.val();
					if(childData.category==temp1[0]){
					console.log(childData.name+" "+id+idnum);
					createDiv(id+(++idnum), childData.name);
					url = childData.imgpath;
					var img = document.getElementById(id+idnum+"_img");
					img.src = url;
				}
					});

				});

			} else {
					console.log("로그아웃 상태");

		}

	});

}

window.onload=function(){
	initApp();
}
</script>

<script>
/*
var user = firebase.auth().currentUser;
if (user != null) {
	name = user.displayName;
	email = user.email;
	photoUrl = user.photoURL;
	emailVerified = user.emailVerified;
	uid = user.uid;
}else{
	console.log("먼가 문제가잇ㅇ므");
}
*/

</script>

<script>

		function downImgURL(imgId){
			var storageRef = firebase.database().ref('/test/'+uid+"/channel_info");
			var pathRef = storageRef.child('basketball_1.jpg');
			firebase.auth().onAuthStateChanged(function(user) {
					if (user) {
						pathRef.getDownloadURL().then(function(url){
							var img = document.getElementById(imgId+"_img");
	            img.src = url;
						//document.getElementById(divname).innerHTML = "<img src='" + url + "'>";
					}).catch(function(error){
						alert(error.message);
					});
					}else{

					}
				});
		}
/*
		firebase.auth().onAuthStateChanged(function(user) {
				if (user) {
			downImgURL();
				}else{

				}
			});
*/
</script>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">

	<!-- Header -->
<div class="inner">
	<header id="header">
		<a href="../../index.html" class="logo"><h1>E-tube</h1> </a>

		<!-- Search -->
		<section id="search" class="alt">
			<form method="post" action="#">
				<input type="text" name="query" id="query" placeholder="Search" />
			</form>
		</section>

		<ul class="icons">
		<li><a href="javascript:openWindowPop('../../login.html', 'popup');" class="fa fa-user-circle fa-lg">
			<span class="label" style="color:#3D4449">
				<a id="logURL" href="javascript:openWindowPop('../../login.html', 'popup');">
					로그인
				</a>
			</span>
			<script>
			switch (localStorage.getItem("logined")) {
				case 'logined':
					document.getElementById("logURL").innerHTML="마이페이지";
					document.getElementById("logURL").setAttribute('href', '../../mychannel.html');
					break;
				case '':
					document.getElementById("logURL").innerHTML="로그인";
					document.getElementById("logURL").setAttribute('href', "javascript:openWindowPop('../../login.html', 'popup');");
					break;
				default:

			}
			</script>
		</a></li>
		</ul>

	</header>

	<section id="sec">

		<header class="major">
			<h2>축구</h2>
		</header>

	</section>
</div>
					</div>

					<div id="sidebar">
    			<div class="inner">

    				<!-- Menu -->
    					<nav id="menu">
    						<header class="major">
    							<h2>카테고리</h2>
    						</header>
    						<ul>
    							<li>
    								<span class="opener">스포츠</span>
    								<ul>
    									<li><a href="../sports/basketball.html">농구</a></li>
    									<li><a href="../sports/baseball.html">야구</a></li>
    									<li><a href="../sports/football.html">축구</a></li>
    									<li><a href="../sports/swimming.html">수영</a></li>
    								</ul>
    							</li>
    							<li>
    								<span class="opener">음악</span>
    								<ul>
    									<li><a href="../music/piano.html">피아노</a></li>
    									<li><a href="../music/guitar.html">기타</a></li>
    									<li><a href="../music/flute.html">플룻</a></li>
    									<li><a href="../music/violin.html">바이올린</a></li>
    								</ul>
    							</li>
    							<li>
    								<span class="opener">생활</span>
    								<ul>
    									<li><a href="../lifestyle/cleaning.html">청소</a></li>
    									<li><a href="../lifestyle/saving.html">저축</a></li>
    									<li><a href="../lifestyle/cooking.html">요리</a></li>
    									<li><a href="../lifestyle/education.html">교육</a></li>
    								</ul>
    							</li>
    							<li>
    								<span class="opener">컴퓨터</span>
    								<ul>
    									<li><a href="../computer/web.html">웹프로그래밍</a></li>
    									<li><a href="../computer/db.html">데이터베이스</a></li>
    									<li><a href="../computer/data_com.html">데이터통신</a></li>
    									<li><a href="../computer/language.html">언어(자바/c++)</a></li>
    								</ul>
    							</li>
    							<li>
    								<span class="opener">게임</span>
    								<ul>
    									<li><a href="../game/lol.html">롤</a></li>
    									<li><a href="../game/fifa.html">피파</a></li>
    									<li><a href="../game/maplestory.html">메이플</a></li>
    									<li><a href="../game/cartrider.html">카트라이더</a></li>
    								</ul>
    							</li>
    							<li><a href="../../studyboard.html">스터디게시판</a></li>

    						</ul>
    					</nav>


    				</div>
    			</div>

		</div>



		<!-- Scripts 아직뭔지 모르겠음-->
    <script src="../../html5/assets/js/jquery_main.js"></script>
    <script src="../../html5/assets/js/browser_main.js"></script>
    <script src="../../html5/assets/js/breakpoints_main.js"></script>
    <script src="../../html5/assets/js/util.js"></script>
    <script src="../../html5/assets/js/main.js"></script>
	</body>
</html>
